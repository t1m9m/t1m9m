<!DOCTYPE html>
<html lang="en">
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<meta content="width=device-width, initial-scale=1, maximum-scale=1.0" name="viewport">
	<title>t1m9m | Support</title>

	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link href="../css/materialize.css" media="screen,projection" rel="stylesheet" type="text/css">
	<link href="../css/materialdesignicons.min.css" rel="stylesheet" type="text/css">

	<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script src="../js/materialize.js"></script>
	<script src="../js/init.js"></script>
    <script src="../greensock/TweenMax.min.js"></script>
</head>
<body>
    <div class="row" style="margin: 1.5% 0">
        <div class="col s12 m6 offset-m3 l6 offset-l3">
          	<div class="card white">
            	<div class="card-content black-text">
              		<span class="card-title" style="margin-left: 1.5%; margin-bottom: 0">Support Form</span>
            	</div>
            	<div class="card-action">
					<div class="row">
						<form action="/send" id="send" method="post" onsubmit="return validateForm()" name="support_form">
	        				<div class="row">
		        				<div class="input-field col s12">
			          				<input name="email" placeholder="Email" id="email" type="email" class="validate">
			          				<label for="email" data-error="Value is required.">Email</label>
			        			</div>
			        		</div>
			        		<div class="row">
								<div class="input-field col s12">
								    <select id="type" name="type">
								      	<option value="" disabled selected>Choose your option</option>
								      	<option value="envato">Envato item support</option>
								      	<option value="custom">Custom project development order</option>
								    </select>
								    <label for="type" data-error="Value is required.">Support Type</label>
								</div>
			        		</div>
			        		<div class="row">
								<div class="input-field col s12">
								    <select id="product" name="product">
								      	<option value="" disabled selected>Choose your option</option>
								      	<option value="venus">Venus</option>
								      	<option value="mars">Mars</option>
								    </select>
								    <label for="product" data-error="Value is required.">Select a Product</label>
								</div>
			        		</div>
							<div class="row">
								<div class="input-field col s12">
			          				<input placeholder="Purchase code" id="code" type="text" class="validate">
			          				<label for="code" data-error="Value is required.">Envato Item Purchase Code</label>
			        			</div>
							</div>	
							<div class="row">
								<div class="input-field col s12">
			          				<input placeholder="Subject" id="subject" type="text" class="validate">
			          				<label for="subject" data-error="Value is required.">Subject</label>
			        			</div>
							</div>
			        		<div class="row">
								<div class="input-field col s12">
						          	<textarea placeholder="Description" id="description" class="materialize-textarea validate"></textarea>
						          	<label for="description" data-error="Value is required.">Description</label>
						        </div>
			        		</div>
							<div class="row">
								<div class="input-field col s3">
									<button type="submit" class="waves-effect waves-light btn black">Submit</button>
								</div>
		      				</div>
	        			</form>
					</div>
            	</div>
          	</div>
        </div>
    </div>

    <script type="text/javascript">
    	$(document).ready(function() {
		    $('select').material_select();
		});
		
		function validateForm() {
	        var email = document.forms["support_form"]["email"].value;
	        var atpos = email.indexOf("@");
	        var dotpos = email.lastIndexOf(".");
	        if (email == "" || atpos < 1 || dotpos < atpos+2 || dotpos+2 >= email.length) {
	            $('#email').focus().addClass("invalid");
	               
	            return false;
	        } else {
				$('#email').removeClass("invalid").addClass("valid");
	        }
	        
	        var type = document.forms["support_form"]["type"].value;
	        if (type == "") {
	            $('#type').focus().parent().find('.select-dropdown').removeClass("select-dropdown").addClass("validate invalid");
	            
	            return false;
	        } else {
				$('#type').parent().find('.validate.invalid').removeClass("invalid").addClass("valid");
	        }
	        
	        var product = document.forms["support_form"]["product"].value;
	        if (product == "" && type == 'envato') {
	            $('#product').focus().parent().find('.select-dropdown').removeClass("select-dropdown").addClass("validate invalid");
	            
	            return false;
	        } else if (product && type == 'envato') {
				$('#product').parent().find('.validate.invalid').removeClass("invalid").addClass("valid");
	        }
			
			var code = document.forms["support_form"]["code"].value;
	        if (code == ""  && type == 'envato') {
	            $('#code').focus().addClass("invalid");
	            
	            return false;
	        } else if (code && type == 'envato') {
				$('#code').removeClass("invalid").addClass("valid");
	        }
	        
	        var subject = document.forms["support_form"]["subject"].value;
	        if (subject == "") {
	            $('#subject').focus().addClass("invalid");
	            
	            return false;
	        } else {
				$('#subject').removeClass("invalid").addClass("valid");
	        }
	        
	        var description = document.forms["support_form"]["description"].value;
	        if (description == "") {
	            $('#description').focus().addClass("invalid");
	            
	            return false;
	        } else {
				$('#description').removeClass("invalid").addClass("valid");
	        }
	        
	        Materialize.toast('I am a toast!', 4000);
		}

		var nodemailer = require('nodemailer');

		app.post('/send', function (req, res) {
		  	var mailOpts, smtpTrans;
		  	//Setup Nodemailer transport, I chose gmail. Create an application-specific password to avoid problems.
		  	smtpTrans = nodemailer.createTransport('SMTP', {
		      	service: 'Gmail',
		      	auth: {
		          	user: "tamim1375@gmail.com",
		          	pass: "vglmnkttafcoawjj" 
		      	}
		  	});
		  	//Mail options
		  	mailOpts = {
		      	from: req.body.name + ' &lt;' + req.body.email + '&gt;', //grab form data from the request body object
		      	to: 'me@gmail.com',
		      	subject: 'Website contact form',
		      	text: req.body.message
		  	};
		  	smtpTrans.sendMail(mailOpts, function (error, response) {
		      	//Email not sent
		      	if (error) {
		          	res.render('contact', { title: 'Raging Flame Laboratory - Contact', msg: 'Error occured, message not sent.', err: true, page: 'contact' })
		      	}
		      	//Yay!! Email sent
		      	else {
		          	res.render('contact', { title: 'Raging Flame Laboratory - Contact', msg: 'Message sent! Thank you.', err: false, page: 'contact' })
		      	}
		  	});
		});
    </script>

    <script>
        // TweenMax.staggerTo(".card", 1, {rotation:360, y:10}, 0.5);
    </script>
</body>
</html>
